# Cerebelum Mobile SDK - Developer Handover Guide

## 1. Project Overview
The Cerebelum Mobile SDK has been refactored to adhere to **Clean Architecture** principles and **SOLID** design patterns. The goal is to provide a robust, testable, and maintainable foundation for future features, specifically focusing on Native Human-in-the-Loop (HITL) capabilities with offline-first support.

## 2. Architecture
The project follows a strict separation of concerns into three layers:

### 2.1 Domain Layer (`com.cerebelum.mobile.domain`)
*   **Pure Kotlin:** No platform-specific dependencies (Android/iOS).
*   **Entities:** `Task`, `TaskStatus`, `SyncStatus` (in `model` package).
*   **Interfaces:** `TaskRepository`, `SyncService` (in `repository` and `usecase` packages).
*   **Use Cases:** Encapsulate business logic.
    *   `ProcessNotificationUseCase`: Handles incoming push notifications.
    *   `SyncTasksUseCase`: Manages synchronization of pending tasks with the backend.

### 2.2 Data Layer (`com.cerebelum.mobile.data`)
*   **Repository Implementation:** `SqlDelightTaskRepository` implements `TaskRepository`.
*   **Local Data Source:** Uses **SQLDelight** for SQLite database access.
    *   Schema: `CerebelumDatabase.sq`.
    *   Driver: `DatabaseDriverFactory` (Platform-specific implementations).
*   **Remote Data Source:** `KtorSyncService` implements `SyncService` using **Ktor Client**.
*   **Mappers:** `TaskEntityMapper` converts between Domain Models and Data Entities.

### 2.3 Presentation/App Layer (`com.cerebelum.mobile`)
*   **Entry Point:** `Cerebelum` object (Singleton).
*   **Dependency Injection:** Manual DI via `DependencyContainer`.
*   **Platform Integration:**
    *   **Android:** `CerebelumMessagingService` (Firebase), `SyncWorker` (WorkManager).
    *   **iOS:** (To be implemented/verified) `BiometricAuthenticator`.

## 3. Key Components & Flows

### Initialization
```kotlin
// Android
Cerebelum.initialize(DatabaseDriverFactory(context))

// iOS
Cerebelum.initialize(DatabaseDriverFactory())
```

### Processing a Notification
1.  Push Notification received by `CerebelumMessagingService` (Android).
2.  Calls `DependencyContainer.processNotificationUseCase(id, type, payload)`.
3.  UseCase creates a `Task` and saves it to `TaskRepository`.

### Synchronization
1.  Triggered by `SyncWorker` (Android) or manual call.
2.  Calls `DependencyContainer.syncTasksUseCase()`.
3.  UseCase gets pending tasks from `TaskRepository`.
4.  Sends tasks via `SyncService` (Ktor).
5.  Updates sync status in `TaskRepository` upon success.

## 4. Build & Test

### Prerequisites
*   JDK 17+
*   Android Studio Koala or newer
*   Xcode 15+ (for iOS)

### Commands
*   **Build Android:** `./gradlew :shared:assembleDebug`
*   **Run Detekt (Static Analysis):** `./gradlew detekt`
    *   *Note: Currently configured to exclude generated code, but may require fine-tuning.*
*   **Run Tests:** `./gradlew test` (To be implemented)

## 5. Current Status & Known Issues

### Completed
*   [x] Refactoring to Clean Architecture (Domain, Data, DI).
*   [x] Implementation of SQLDelight for local storage.
*   [x] Implementation of Ktor for remote sync.
*   [x] Android integration (FCM, WorkManager).
*   [x] Detekt integration (Configuration in `detekt.yml`).

### In Progress / To Do
*   [ ] **Fix Detekt Exclusions:** Detekt is currently flagging issues in generated SQLDelight code despite exclusion attempts. Needs further configuration in `build.gradle.kts`.
*   [ ] **Unit Tests:** Comprehensive unit tests for Use Cases and Repositories need to be written (Target: >80% coverage).
*   [ ] **iOS Integration:** Verify `BiometricAuthenticator` and ensure the iOS build pipeline is stable.
*   [ ] **CI/CD:** Set up GitHub Actions for automated building and testing.

## 6. Next Steps for the Team
1.  **Resolve Detekt Issues:** Finalize the configuration to strictly ignore `build/generated` directories.
2.  **Write Unit Tests:** Start with `ProcessNotificationUseCaseTest` and `SyncTasksUseCaseTest`.
3.  **Verify iOS:** Run the iOS sample app and verify the biometric auth flow.
4.  **API Integration:** Update `KtorSyncService` with the real backend API URL and authentication headers.

---
*Generated by Antigravity on 2025-11-21*
